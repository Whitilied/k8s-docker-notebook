# Kubernetes架构

在一个分布式存储顶层运行的k8s集群包含节点代理和master组件。下图描述了k8s集群的最终状态，目前仍然在开发中，最终目标是希望所有组件以容器的方式运行，并且是scheduler模块100%可拆卸。



### Kubernetes节点（Node）

纵观系统架构，可以发现一些服务运行在工作节点，一些服务组成集群控制层。

k8s节点必须能够执行应用容器并且服从master的管理。每个k8s节点都运行docker，并且下载镜像已经启动容器都由docker执行。

**kubelet**

kubelet管理pod内的容器，镜像，存储卷等

**kube-proxy**

每个节点都运行一个简单的网络代理和负载均衡。k8s API规定每个节点都能够跨后台转发简单的TCP或者UDP流量，即services



### Kubernetes控制层

k8s控制层由一系列组件组成。目前所有组件均运行在单个master节点中，很快这种情况就会改变并且能够支持高可用集群。这些组件共同提供了一个集群统一视图。

**etcd**

所有master持久状态都存储在一个etcd实例中。这提供了一个可靠的存储配置的方式。由于watch支持，组件之间可以很快发现变更。

**k8s API Server**

apiserver提供k8s API。是一种CRUD-y的服务，大多数的业务逻辑在单独的组件或插件中实现。主要处理REST操作，验证，更新存储在etcd中的对象。

**scheduler**

使用/binding接口将未调度的pod绑定到节点上。scheduler模块是可拆卸的，我们期望未来支持多个集群的调度程序甚至用户提供的调度程序。

**k8s控制管理服务**

所有集群层面的功能都由控制管理服务执行。